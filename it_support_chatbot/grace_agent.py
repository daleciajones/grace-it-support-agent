from openai import OpenAI
from dotenv import load_dotenv
import os
import random

# --- Load environment variables securely ---
dotenv_path = os.path.join(os.path.dirname(__file__), '.env')
load_dotenv(dotenv_path)

api_key = os.getenv("OPENAI_API_KEY")

if api_key:
    client = OpenAI(api_key=api_key)
else:
    print("Grace: Iâ€™m offline right now â€” please check my connection or API settings ðŸ’œ")
    client = None  # Grace wonâ€™t run without this key, but stays friendly


# --- Graceâ€™s fallback responses by category ---
fallback_categories = {
    "network": [
        "Grace: I donâ€™t have that specific network fix yet, but I can walk you through checking your Wi-Fi connection.",
        "Grace: That might be a connectivity issue. Try restarting your router or verifying your network adapter settings."
    ],
    "password": [
        "Grace: I canâ€™t reset passwords directly, but I can guide you through the password reset process.",
        "Grace: Make sure your password meets your companyâ€™s security policy â€” length, symbols, and numbers all matter!"
    ],
    "hardware": [
        "Grace: Iâ€™m not sure about that hardware issue, but I can help you check drivers or connection ports.",
        "Grace: It might be a hardware fault â€” try unplugging and reconnecting your device before escalating."
    ],
    "permissions": [
        "Grace: It sounds like a permissions issue. You might not have access rights for that action â€” try contacting your admin.",
        "Grace: Letâ€™s verify your account permissions before proceeding â€” that often resolves access issues."
    ],
    "webcam": [
        "Grace: Letâ€™s make sure your webcam is enabled in your system settings and not blocked by another app.",
        "Grace: Try unplugging and reconnecting your webcam â€” and check if your browser or app has permission to access it."
    ],
    "default": [
        "Grace: Hmm, I donâ€™t have that information yet â€” but I can log it for review or help you troubleshoot another issue!",
        "Grace: Iâ€™m not sure about that one, but I can assist with other IT topics like passwords or Wi-Fi."
    ]
}


# --- Graceâ€™s introduction ---
if client:
    print("Hello! Iâ€™m Grace, your IT Support Assistant.")
    print("I can help with password resets, Wi-Fi issues, and other common IT problems you may run into.\n")
    print("Type 'exit' anytime to end the conversation.\n")

    while True:
        user_input = input("You: ")
        if user_input.lower() in ["exit", "quit"]:
            print("Grace: Goodbye! Stay productive ðŸ’œ")
            break

        # --- Chatbot response ---
        response = client.chat.completions.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "You are Grace, a friendly IT Support Assistant."},
                {"role": "user", "content": user_input}
            ]
        )

        print("Grace:", response.choices[0].message.content)